<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC Tax & Budget Calculator</title>
<style>
:root {
  --bg: #0f1117;
  --surface: #1a1d27;
  --surface2: #242836;
  --border: #2e3347;
  --text: #e4e6f0;
  --text-muted: #8b90a5;
  --accent: #6c8cff;
  --accent-dim: #4a62b8;
  --green: #4caf7d;
  --red: #e05565;
  --orange: #e0a050;
  --yellow: #d4c455;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 20px;
}

header {
  text-align: center;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--border);
}

header h1 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 6px;
}

header p {
  color: var(--text-muted);
  font-size: 14px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

@media (max-width: 860px) {
  .grid { grid-template-columns: 1fr; }
}

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
}

.card h2 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card h2 .icon {
  font-size: 18px;
}

.card.full-width {
  grid-column: 1 / -1;
}

/* Form elements */
.field {
  margin-bottom: 16px;
}

.field:last-child {
  margin-bottom: 0;
}

.field label {
  display: block;
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 5px;
  font-weight: 500;
}

.field input, .field select {
  width: 100%;
  padding: 10px 12px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 15px;
  font-family: inherit;
  transition: border-color 0.15s;
}

.field input:focus, .field select:focus {
  outline: none;
  border-color: var(--accent);
}

.field input::placeholder {
  color: var(--text-muted);
  opacity: 0.6;
}

.field-row {
  display: flex;
  gap: 12px;
}

.field-row .field {
  flex: 1;
}

.field .hint {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 3px;
}

/* Spending categories */
.spending-section {
  margin-bottom: 20px;
}

.spending-section:last-child {
  margin-bottom: 0;
}

.spending-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

.spending-header h3 {
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}

.spending-header .freq-badge {
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 10px;
  font-weight: 500;
}

.freq-annual .freq-badge { background: #2a2040; color: #b08cff; }
.freq-monthly .freq-badge { background: #1a2a3a; color: #6cb8ff; }
.freq-weekly .freq-badge { background: #1a3028; color: #5cc89a; }
.freq-daily .freq-badge { background: #2a2a1a; color: #d4c455; }

.spending-items {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

@media (max-width: 500px) {
  .spending-items { grid-template-columns: 1fr; }
}

.spending-item {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 10px;
}

.spending-item label {
  font-size: 13px;
  color: var(--text-muted);
  white-space: nowrap;
  min-width: 90px;
}

.spending-item input {
  width: 100%;
  padding: 6px 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text);
  font-size: 14px;
  font-family: inherit;
  text-align: right;
}

.spending-item input:focus {
  outline: none;
  border-color: var(--accent);
}

.spending-subtotal {
  text-align: right;
  font-size: 13px;
  color: var(--text-muted);
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid var(--border);
}

.spending-subtotal span {
  color: var(--text);
  font-weight: 600;
}

/* Results */
.result-group {
  margin-bottom: 20px;
}

.result-group:last-child {
  margin-bottom: 0;
}

.result-group h3 {
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 10px;
}

.result-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 7px 0;
  font-size: 14px;
}

.result-row.indent {
  padding-left: 16px;
  font-size: 13px;
  color: var(--text-muted);
}

.result-row.total {
  font-weight: 700;
  font-size: 15px;
  padding-top: 10px;
  margin-top: 6px;
  border-top: 1px solid var(--border);
}

.result-row .val { font-variant-numeric: tabular-nums; }
.result-row .val.negative { color: var(--red); }
.result-row .val.positive { color: var(--green); }
.result-row .val.accent { color: var(--accent); }

.rate-badge {
  font-size: 11px;
  color: var(--text-muted);
  margin-left: 6px;
}

/* Summary bar */
.summary-bar {
  margin-top: 24px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

@media (max-width: 600px) {
  .summary-bar { grid-template-columns: repeat(2, 1fr); }
}

.summary-stat {
  background: var(--surface2);
  border-radius: 10px;
  padding: 16px;
  text-align: center;
}

.summary-stat .label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.summary-stat .value {
  font-size: 22px;
  font-weight: 700;
  font-variant-numeric: tabular-nums;
}

.summary-stat .sub {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 2px;
}

.surplus { color: var(--green); }
.deficit { color: var(--red); }
.neutral { color: var(--accent); }

/* Bar chart */
.bar-chart {
  margin-top: 16px;
}

.bar-row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
  font-size: 13px;
}

.bar-label {
  width: 120px;
  color: var(--text-muted);
  flex-shrink: 0;
}

.bar-track {
  flex: 1;
  height: 22px;
  background: var(--surface2);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.3s ease;
  min-width: 2px;
}

.bar-value {
  width: 90px;
  text-align: right;
  font-variant-numeric: tabular-nums;
  flex-shrink: 0;
  padding-left: 10px;
}

.bar-federal { background: #6c8cff; }
.bar-state { background: #b08cff; }
.bar-city { background: #ff8c6c; }
.bar-fica { background: #5cc89a; }
.bar-insurance { background: #e0a050; }
.bar-retirement { background: #d4c455; }

/* Footer */
footer {
  margin-top: 32px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
  text-align: center;
  font-size: 12px;
  color: var(--text-muted);
}

/* Priority sliders */
.sliders-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px 24px;
}

@media (max-width: 700px) {
  .sliders-grid { grid-template-columns: 1fr; }
}

.slider-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.slider-label-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.slider-label-row label {
  font-size: 13px;
  font-weight: 500;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 6px;
}

.slider-label-row .slider-mult {
  font-size: 12px;
  font-weight: 600;
  padding: 1px 8px;
  border-radius: 8px;
  font-variant-numeric: tabular-nums;
}

.slider-track {
  position: relative;
  display: flex;
  align-items: center;
}

.slider-track input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: var(--surface2);
  outline: none;
  cursor: pointer;
}

.slider-track input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--accent);
  border: 2px solid var(--bg);
  box-shadow: 0 0 0 1px var(--accent-dim);
  cursor: pointer;
  transition: transform 0.1s;
}

.slider-track input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.15);
}

.slider-track input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--accent);
  border: 2px solid var(--bg);
  box-shadow: 0 0 0 1px var(--accent-dim);
  cursor: pointer;
}

.slider-scale {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: var(--text-muted);
  margin-top: -2px;
}

.slider-amount {
  font-weight: 600;
  color: var(--text);
  font-size: 11px;
}

/* Spending breakdown by category */
.spending-cat-row {
  display: flex;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  font-size: 13px;
}

.spending-cat-row:last-child {
  border-bottom: none;
}

.cat-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 10px;
  flex-shrink: 0;
}

.cat-name {
  flex: 1;
  color: var(--text);
}

.cat-freq {
  color: var(--text-muted);
  margin-right: 16px;
  font-variant-numeric: tabular-nums;
  min-width: 80px;
  text-align: right;
}

.cat-annual {
  color: var(--text);
  font-weight: 600;
  font-variant-numeric: tabular-nums;
  min-width: 70px;
  text-align: right;
}

.slider-group[data-color="blue"] .slider-mult { background: #1a2a3a; color: #6cb8ff; }
.slider-group[data-color="green"] .slider-mult { background: #1a3028; color: #5cc89a; }
.slider-group[data-color="purple"] .slider-mult { background: #2a2040; color: #b08cff; }
.slider-group[data-color="orange"] .slider-mult { background: #2a2518; color: #e0a050; }
.slider-group[data-color="red"] .slider-mult { background: #2a1a1a; color: #e07070; }
.slider-group[data-color="yellow"] .slider-mult { background: #2a2a1a; color: #d4c455; }

.slider-group[data-color="blue"] input[type="range"]::-webkit-slider-thumb { background: #6cb8ff; box-shadow: 0 0 0 1px #3a6899; }
.slider-group[data-color="green"] input[type="range"]::-webkit-slider-thumb { background: #5cc89a; box-shadow: 0 0 0 1px #3a7a5a; }
.slider-group[data-color="purple"] input[type="range"]::-webkit-slider-thumb { background: #b08cff; box-shadow: 0 0 0 1px #6a5099; }
.slider-group[data-color="orange"] input[type="range"]::-webkit-slider-thumb { background: #e0a050; box-shadow: 0 0 0 1px #996830; }
.slider-group[data-color="red"] input[type="range"]::-webkit-slider-thumb { background: #e07070; box-shadow: 0 0 0 1px #994040; }
.slider-group[data-color="yellow"] input[type="range"]::-webkit-slider-thumb { background: #d4c455; box-shadow: 0 0 0 1px #998a30; }

.slider-group[data-color="blue"] input[type="range"]::-moz-range-thumb { background: #6cb8ff; box-shadow: 0 0 0 1px #3a6899; }
.slider-group[data-color="green"] input[type="range"]::-moz-range-thumb { background: #5cc89a; box-shadow: 0 0 0 1px #3a7a5a; }
.slider-group[data-color="purple"] input[type="range"]::-moz-range-thumb { background: #b08cff; box-shadow: 0 0 0 1px #6a5099; }
.slider-group[data-color="orange"] input[type="range"]::-moz-range-thumb { background: #e0a050; box-shadow: 0 0 0 1px #996830; }
.slider-group[data-color="red"] input[type="range"]::-moz-range-thumb { background: #e07070; box-shadow: 0 0 0 1px #994040; }
.slider-group[data-color="yellow"] input[type="range"]::-moz-range-thumb { background: #d4c455; box-shadow: 0 0 0 1px #998a30; }

/* Preset buttons */
.presets {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.preset-btn {
  padding: 6px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 20px;
  color: var(--text-muted);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.15s;
  font-family: inherit;
}

.preset-btn:hover {
  border-color: var(--accent);
  color: var(--text);
}

.preset-btn.active {
  background: var(--accent-dim);
  border-color: var(--accent);
  color: white;
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>NYC Tax & Budget Calculator</h1>
    <p>Federal + NY State + NYC taxes | 2024 brackets | Take-home pay & lifestyle budget planner</p>
  </header>

  <!-- Presets -->
  <div class="card full-width" style="margin-bottom: 24px;">
    <h2><span class="icon">&#9881;</span> Quick Presets</h2>
    <div class="presets">
      <button class="preset-btn" onclick="applyPreset('junior', this)">Junior ($150K)</button>
      <button class="preset-btn" onclick="applyPreset('mid', this)">Mid-Level ($225K)</button>
      <button class="preset-btn" onclick="applyPreset('senior', this)">Senior ($350K)</button>
      <button class="preset-btn" onclick="applyPreset('staff', this)">Staff/Principal ($500K)</button>
      <button class="preset-btn" onclick="applyPreset('director', this)">Director ($750K)</button>
      <button class="preset-btn" onclick="applyPreset('exec', this)">Executive ($1.2M)</button>
    </div>
  </div>

  <!-- Lifestyle Priority Sliders -->
  <div class="card full-width" style="margin-bottom: 24px;">
    <h2><span class="icon">&#9878;</span> Lifestyle Priorities <span style="font-weight: 400; font-size: 12px; color: var(--text-muted); margin-left: 8px;">Set spending as % of gross income</span></h2>
    <div class="sliders-grid">
      <div class="slider-group" data-color="blue" data-slider="housing">
        <div class="slider-label-row">
          <label>Housing &amp; Home</label>
          <span class="slider-mult" id="mult-housing">27.5%</span>
        </div>
        <div class="slider-track">
          <input type="range" min="0" max="100" step="1" value="50" id="slider-housing" oninput="onSlider(this)">
        </div>
        <div class="slider-scale"><span>5%</span><span class="slider-amount" id="amount-housing"></span><span>50%</span></div>
      </div>

      <div class="slider-group" data-color="green" data-slider="food">
        <div class="slider-label-row">
          <label>Food &amp; Dining</label>
          <span class="slider-mult" id="mult-food">5.5%</span>
        </div>
        <div class="slider-track">
          <input type="range" min="0" max="100" step="1" value="50" id="slider-food" oninput="onSlider(this)">
        </div>
        <div class="slider-scale"><span>1%</span><span class="slider-amount" id="amount-food"></span><span>10%</span></div>
      </div>

      <div class="slider-group" data-color="purple" data-slider="nightlife">
        <div class="slider-label-row">
          <label>Going Out &amp; Social</label>
          <span class="slider-mult" id="mult-nightlife">5.3%</span>
        </div>
        <div class="slider-track">
          <input type="range" min="0" max="100" step="1" value="50" id="slider-nightlife" oninput="onSlider(this)">
        </div>
        <div class="slider-scale"><span>0.5%</span><span class="slider-amount" id="amount-nightlife"></span><span>10%</span></div>
      </div>

      <div class="slider-group" data-color="orange" data-slider="travel">
        <div class="slider-label-row">
          <label>Travel &amp; Experiences</label>
          <span class="slider-mult" id="mult-travel">10.5%</span>
        </div>
        <div class="slider-track">
          <input type="range" min="0" max="100" step="1" value="50" id="slider-travel" oninput="onSlider(this)">
        </div>
        <div class="slider-scale"><span>1%</span><span class="slider-amount" id="amount-travel"></span><span>20%</span></div>
      </div>

      <div class="slider-group" data-color="red" data-slider="health">
        <div class="slider-label-row">
          <label>Health &amp; Wellness</label>
          <span class="slider-mult" id="mult-health">2.6%</span>
        </div>
        <div class="slider-track">
          <input type="range" min="0" max="100" step="1" value="50" id="slider-health" oninput="onSlider(this)">
        </div>
        <div class="slider-scale"><span>0.1%</span><span class="slider-amount" id="amount-health"></span><span>5%</span></div>
      </div>

      <div class="slider-group" data-color="yellow" data-slider="shopping">
        <div class="slider-label-row">
          <label>Style &amp; Shopping</label>
          <span class="slider-mult" id="mult-shopping">8%</span>
        </div>
        <div class="slider-track">
          <input type="range" min="0" max="100" step="1" value="50" id="slider-shopping" oninput="onSlider(this)">
        </div>
        <div class="slider-scale"><span>1%</span><span class="slider-amount" id="amount-shopping"></span><span>15%</span></div>
      </div>
    </div>
  </div>

  <div class="grid">
    <!-- LEFT COLUMN: Inputs -->
    <div>
      <!-- Income -->
      <div class="card" style="margin-bottom: 24px;">
        <h2><span class="icon">&#128176;</span> Income</h2>
        <div class="field">
          <label>Base Salary (Annual)</label>
          <input type="text" id="salary" inputmode="numeric" placeholder="200,000" oninput="formatAndCalc(this)">
        </div>
        <div class="field">
          <label>Annual Bonus</label>
          <input type="text" id="bonus" inputmode="numeric" placeholder="40,000" oninput="formatAndCalc(this)">
          <div class="hint">Taxed as supplemental income (same brackets apply)</div>
        </div>
        <div class="field">
          <label>Other Income (RSUs, Side Income, etc.)</label>
          <input type="text" id="otherIncome" inputmode="numeric" placeholder="0" oninput="formatAndCalc(this)">
        </div>
        <div class="field">
          <label>Filing Status</label>
          <select id="filingStatus" onchange="recalculate()">
            <option value="single">Single</option>
            <option value="married">Married Filing Jointly</option>
          </select>
        </div>
      </div>

      <!-- Pre-tax Deductions -->
      <div class="card" style="margin-bottom: 24px;">
        <h2><span class="icon">&#128179;</span> Pre-Tax Deductions</h2>
        <div class="field-row">
          <div class="field">
            <label>401(k) Contribution</label>
            <input type="text" id="retirement" inputmode="numeric" placeholder="23,500" oninput="formatAndCalc(this)">
            <div class="hint">2024 limit: $23,500</div>
          </div>
          <div class="field">
            <label>Health Insurance (Annual)</label>
            <input type="text" id="insurance" inputmode="numeric" placeholder="3,600" oninput="formatAndCalc(this)">
            <div class="hint">Pre-tax premium (employer plan)</div>
          </div>
        </div>
        <div class="field-row">
          <div class="field">
            <label>HSA Contribution</label>
            <input type="text" id="hsa" inputmode="numeric" placeholder="0" oninput="formatAndCalc(this)">
            <div class="hint">2024 limit: $4,150 (self)</div>
          </div>
          <div class="field">
            <label>Other Pre-Tax Deductions</label>
            <input type="text" id="otherDeductions" inputmode="numeric" placeholder="0" oninput="formatAndCalc(this)">
            <div class="hint">Transit, FSA, etc.</div>
          </div>
        </div>
      </div>

      <!-- Spending by Category (driven by sliders) -->
      <div class="card">
        <h2><span class="icon">&#128184;</span> Spending Breakdown</h2>
        <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;">Adjust the sliders above to change spending allocations</p>
        <div id="spending-breakdown"></div>
      </div>
    </div>

    <!-- RIGHT COLUMN: Results -->
    <div>
      <!-- Tax Breakdown -->
      <div class="card" style="margin-bottom: 24px;">
        <h2><span class="icon">&#128200;</span> Tax Breakdown</h2>

        <div class="result-group">
          <h3>Gross Income</h3>
          <div class="result-row">
            <span>Base Salary</span>
            <span class="val" id="r-salary">$0</span>
          </div>
          <div class="result-row">
            <span>Bonus</span>
            <span class="val" id="r-bonus">$0</span>
          </div>
          <div class="result-row">
            <span>Other Income</span>
            <span class="val" id="r-other">$0</span>
          </div>
          <div class="result-row total">
            <span>Total Gross</span>
            <span class="val accent" id="r-gross">$0</span>
          </div>
        </div>

        <div class="result-group">
          <h3>Pre-Tax Deductions</h3>
          <div class="result-row indent">
            <span>401(k)</span>
            <span class="val negative" id="r-401k">$0</span>
          </div>
          <div class="result-row indent">
            <span>Health Insurance</span>
            <span class="val negative" id="r-ins">$0</span>
          </div>
          <div class="result-row indent">
            <span>HSA</span>
            <span class="val negative" id="r-hsa">$0</span>
          </div>
          <div class="result-row indent">
            <span>Other Pre-Tax</span>
            <span class="val negative" id="r-othded">$0</span>
          </div>
          <div class="result-row total">
            <span>Taxable Income</span>
            <span class="val" id="r-taxable">$0</span>
          </div>
        </div>

        <div class="result-group">
          <h3>Taxes</h3>
          <div class="result-row">
            <span>Federal Income Tax <span class="rate-badge" id="r-fed-rate"></span></span>
            <span class="val negative" id="r-fed">$0</span>
          </div>
          <div class="result-row">
            <span>NY State Tax <span class="rate-badge" id="r-state-rate"></span></span>
            <span class="val negative" id="r-state">$0</span>
          </div>
          <div class="result-row">
            <span>NYC Tax <span class="rate-badge" id="r-city-rate"></span></span>
            <span class="val negative" id="r-city">$0</span>
          </div>
          <div class="result-row">
            <span>Social Security <span class="rate-badge">6.2%</span></span>
            <span class="val negative" id="r-ss">$0</span>
          </div>
          <div class="result-row">
            <span>Medicare <span class="rate-badge" id="r-med-rate">1.45%</span></span>
            <span class="val negative" id="r-med">$0</span>
          </div>
          <div class="result-row total">
            <span>Total Tax</span>
            <span class="val negative" id="r-totaltax">$0</span>
          </div>
        </div>

        <div class="result-group">
          <div class="result-row total" style="border-top: 2px solid var(--accent);">
            <span>Effective Tax Rate</span>
            <span class="val accent" id="r-effective-rate">0%</span>
          </div>
        </div>

        <!-- Visual bar chart of deductions -->
        <div class="bar-chart" id="tax-bars"></div>
      </div>

      <!-- Take-Home -->
      <div class="card" style="margin-bottom: 24px;">
        <h2><span class="icon">&#127968;</span> Take-Home Pay</h2>
        <div class="result-row total" style="border-top: none; margin-top: 0; padding-top: 0;">
          <span>Annual Take-Home</span>
          <span class="val positive" id="r-takehome-annual">$0</span>
        </div>
        <div class="result-row">
          <span>Monthly Take-Home</span>
          <span class="val positive" id="r-takehome-monthly">$0</span>
        </div>
        <div class="result-row">
          <span>Biweekly Paycheck</span>
          <span class="val" id="r-takehome-biweekly">$0</span>
        </div>
      </div>

      <!-- Budget Summary -->
      <div class="card" style="margin-bottom: 24px;">
        <h2><span class="icon">&#128202;</span> Budget Summary</h2>
        <div class="result-row">
          <span>Annual Take-Home</span>
          <span class="val positive" id="r-budget-income">$0</span>
        </div>
        <div id="r-category-breakdown"></div>
        <div class="result-row total">
          <span>Total Annual Spending</span>
          <span class="val negative" id="r-total-spending">$0</span>
        </div>
        <div class="result-row total" style="border-top: 2px solid var(--green);">
          <span id="r-remainder-label">Annual Savings</span>
          <span class="val" id="r-remainder">$0</span>
        </div>
        <div class="result-row">
          <span id="r-remainder-mo-label">Monthly Savings</span>
          <span class="val" id="r-remainder-mo">$0</span>
        </div>
        <div class="result-row" style="margin-top: 8px;">
          <span>Savings Rate</span>
          <span class="val" id="r-savings-rate">0%</span>
        </div>
      </div>

      <!-- Summary Stats -->
      <div class="card">
        <h2><span class="icon">&#9889;</span> At a Glance</h2>
        <div class="summary-bar">
          <div class="summary-stat">
            <div class="label">Gross</div>
            <div class="value neutral" id="s-gross">$0</div>
            <div class="sub">annual</div>
          </div>
          <div class="summary-stat">
            <div class="label">Taxes + Ded.</div>
            <div class="value" style="color: var(--red);" id="s-taxes">$0</div>
            <div class="sub" id="s-tax-pct">0%</div>
          </div>
          <div class="summary-stat">
            <div class="label">Spending</div>
            <div class="value" style="color: var(--orange);" id="s-spending">$0</div>
            <div class="sub" id="s-spend-pct">0%</div>
          </div>
          <div class="summary-stat">
            <div class="label">Savings</div>
            <div class="value" id="s-savings">$0</div>
            <div class="sub" id="s-save-pct">0%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>Tax brackets: 2024 IRS (Federal), NY State, NYC. Standard deduction applied. For estimation only — consult a tax professional.</p>
  </footer>
</div>

<script src="tax-engine.js"></script>
<script>
// ─────────────────────────────────────────────────────────────
// DOM Layer — reads inputs, delegates to TaxEngine, writes results
// ─────────────────────────────────────────────────────────────

var E = TaxEngine; // short alias

// ── DOM Helpers ─────────────────────────────────────────────

var $ = document.getElementById.bind(document);

function readField(id) {
  return E.parseInputValue($(id).value);
}

function setField(id, val) {
  $(id).value = val.toLocaleString();
}

function setText(id, text) {
  $(id).textContent = text;
}

// ── Input Gathering ─────────────────────────────────────────

function gatherInputs() {
  return {
    salary: readField('salary'),
    bonus: readField('bonus'),
    otherIncome: readField('otherIncome'),
    retirement: readField('retirement'),
    insurance: readField('insurance'),
    hsa: readField('hsa'),
    otherDeductions: readField('otherDeductions'),
    filing: $('filingStatus').value,
  };
}

function gatherSpending() {
  var spending = { annual: {}, monthly: {}, weekly: {}, daily: {} };
  var inputs = document.querySelectorAll('input[data-freq][data-key]');
  for (var i = 0; i < inputs.length; i++) {
    var inp = inputs[i];
    spending[inp.dataset.freq][inp.dataset.key] = E.parseInputValue(inp.value);
  }
  return spending;
}

// ── Result Rendering ────────────────────────────────────────

function renderTaxResults(t) {
  // Income
  setText('r-salary', E.fmt(t.salary));
  setText('r-bonus', E.fmt(t.bonus));
  setText('r-other', E.fmt(t.otherIncome));
  setText('r-gross', E.fmt(t.gross));

  // Pre-tax
  setText('r-401k', E.fmt(-t.retirement));
  setText('r-ins', E.fmt(-t.insurance));
  setText('r-hsa', E.fmt(-t.hsa));
  setText('r-othded', E.fmt(-t.otherDed));
  setText('r-taxable', E.fmt(t.taxableIncome));

  // Taxes
  setText('r-fed', E.fmt(-t.federal.tax));
  setText('r-fed-rate', E.pct(t.federal.topRate));
  setText('r-state', E.fmt(-t.state.tax));
  setText('r-state-rate', E.pct(t.state.topRate));
  setText('r-city', E.fmt(-t.city.tax));
  setText('r-city-rate', E.pct(t.city.topRate));
  setText('r-ss', E.fmt(-t.ssTax));
  setText('r-med', E.fmt(-t.medicareTax));
  setText('r-med-rate', t.gross > t.medicareThreshold ? '2.35%' : '1.45%');
  setText('r-totaltax', E.fmt(-t.totalTax));
  setText('r-effective-rate', E.pct(t.effectiveRate));

  // Take-home
  setText('r-takehome-annual', E.fmt(t.takeHome));
  setText('r-takehome-monthly', E.fmt(t.takeHome / 12));
  setText('r-takehome-biweekly', E.fmt(t.takeHome / 26));

  // Tax bar chart
  renderTaxBars(t);
}

function renderTaxBars(t) {
  var maxTax = Math.max(t.federal.tax, t.state.tax, t.city.tax, t.ssTax, t.medicareTax, 1);
  var barData = [
    { label: 'Federal', value: t.federal.tax, cls: 'bar-federal' },
    { label: 'NY State', value: t.state.tax, cls: 'bar-state' },
    { label: 'NYC', value: t.city.tax, cls: 'bar-city' },
    { label: 'Soc. Security', value: t.ssTax, cls: 'bar-fica' },
    { label: 'Medicare', value: t.medicareTax, cls: 'bar-fica' },
    { label: 'Health Ins.', value: t.insurance, cls: 'bar-insurance' },
    { label: '401(k)', value: t.retirement, cls: 'bar-retirement' },
  ];
  var html = '';
  for (var i = 0; i < barData.length; i++) {
    var b = barData[i];
    var w = Math.max(0, (b.value / maxTax) * 100);
    html += '<div class="bar-row">' +
      '<span class="bar-label">' + b.label + '</span>' +
      '<div class="bar-track"><div class="bar-fill ' + b.cls + '" style="width:' + w + '%"></div></div>' +
      '<span class="bar-value">' + E.fmt(b.value) + '</span>' +
      '</div>';
  }
  $('tax-bars').innerHTML = html;
}

var CATEGORY_COLORS = {
  housing: '#6cb8ff',
  food: '#5cc89a',
  nightlife: '#b08cff',
  travel: '#e0a050',
  health: '#e07070',
  shopping: '#d4c455',
};

function renderSpendingBreakdown(grossIncome) {
  var html = '';
  var names = Object.keys(E.SLIDER_CONFIG);

  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    var config = E.SLIDER_CONFIG[name];
    var slider = $('slider-' + name);
    if (!slider) continue;

    var result = E.computeSliderAmount(name, parseFloat(slider.value), grossIncome);
    var freqLabel = FREQ_LABELS[config.displayFreq] || '/yr';
    var color = CATEGORY_COLORS[name] || 'var(--text)';

    html += '<div class="spending-cat-row">' +
      '<span class="cat-dot" style="background:' + color + '"></span>' +
      '<span class="cat-name">' + config.label + '</span>' +
      '<span class="cat-freq">' + E.fmt(result.displayAmount) + freqLabel + '</span>' +
      '<span class="cat-annual">' + E.fmtk(result.annualAmount) + '/yr</span>' +
      '</div>';
  }

  $('spending-breakdown').innerHTML = html;
}

function renderCategoryBreakdown(grossIncome) {
  var html = '';
  var names = Object.keys(E.SLIDER_CONFIG);

  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    var config = E.SLIDER_CONFIG[name];
    var slider = $('slider-' + name);
    if (!slider) continue;

    var result = E.computeSliderAmount(name, parseFloat(slider.value), grossIncome);

    html += '<div class="result-row indent">' +
      '<span>' + config.label + '</span>' +
      '<span class="val">' + E.fmt(-result.annualAmount) + '</span>' +
      '</div>';
  }

  $('r-category-breakdown').innerHTML = html;
}

function renderBudgetSummary(budget, grossIncome) {
  var t = budget.taxes;
  var s = budget.spending;
  var remainder = budget.remainder;
  var savingsRate = budget.savingsRate;

  setText('r-budget-income', E.fmt(t.takeHome));
  renderCategoryBreakdown(grossIncome);
  setText('r-total-spending', E.fmt(-s.totalAnnual));

  setText('r-remainder', E.fmt(remainder));
  $('r-remainder').className = 'val ' + (remainder >= 0 ? 'positive' : 'negative');
  setText('r-remainder-label', remainder >= 0 ? 'Annual Savings' : 'Annual Deficit');

  setText('r-remainder-mo', E.fmt(remainder / 12));
  $('r-remainder-mo').className = 'val ' + (remainder >= 0 ? 'positive' : 'negative');
  setText('r-remainder-mo-label', remainder >= 0 ? 'Monthly Savings' : 'Monthly Deficit');

  var srEl = $('r-savings-rate');
  srEl.textContent = E.pct(savingsRate);
  srEl.className = 'val ' + (savingsRate >= 0.2 ? 'positive' : savingsRate >= 0 ? 'accent' : 'negative');

  // At a glance
  setText('s-gross', E.fmtk(t.gross));
  setText('s-taxes', E.fmtk(t.totalDeductions));
  setText('s-tax-pct', t.gross > 0 ? E.pct(t.totalDeductions / t.gross) + ' of gross' : '0%');
  setText('s-spending', E.fmtk(s.totalAnnual));
  setText('s-spend-pct', t.takeHome > 0 ? E.pct(s.totalAnnual / t.takeHome) + ' of net' : '0%');
  setText('s-savings', E.fmtk(remainder));
  $('s-savings').className = 'value ' + (remainder >= 0 ? 'surplus' : 'deficit');
  setText('s-save-pct', t.takeHome > 0 ? E.pct(remainder / t.takeHome) + ' of net' : '0%');
}

// ── Main Orchestrator ───────────────────────────────────────

function gatherSliderSpending(grossIncome) {
  // Compute spending from percentage-of-income sliders
  var sliderSpending = { annual: 0, monthly: 0, weekly: 0, daily: 0 };
  var names = Object.keys(E.SLIDER_CONFIG);

  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    var slider = $('slider-' + name);
    if (!slider) continue;

    var sliderValue = parseFloat(slider.value);
    var result = E.computeSliderAmount(name, sliderValue, grossIncome);
    var config = E.SLIDER_CONFIG[name];

    // Add to the appropriate frequency bucket
    if (config.displayFreq === 'annual') {
      sliderSpending.annual += result.annualAmount;
    } else if (config.displayFreq === 'monthly') {
      sliderSpending.monthly += result.annualAmount / 12;
    } else if (config.displayFreq === 'weekly') {
      sliderSpending.weekly += result.annualAmount / 52;
    } else if (config.displayFreq === 'daily') {
      sliderSpending.daily += result.annualAmount / 365;
    }
  }

  return sliderSpending;
}

function recalculate() {
  var inputs = gatherInputs();
  var grossIncome = inputs.salary + inputs.bonus + inputs.otherIncome;

  // Compute slider-based spending
  var sliderSpend = gatherSliderSpending(grossIncome);

  // Build spending object for computeBudget
  var spending = {
    annual: { sliderTotal: sliderSpend.annual },
    monthly: { sliderTotal: sliderSpend.monthly },
    weekly: { sliderTotal: sliderSpend.weekly },
    daily: { sliderTotal: sliderSpend.daily },
  };

  var budget = E.computeBudget(inputs, spending);

  renderTaxResults(budget.taxes);
  renderSpendingBreakdown(grossIncome);
  renderBudgetSummary(budget, grossIncome);

  // Update slider displays when income changes
  updateAllSliderDisplays();
}

// ── Input Formatting ────────────────────────────────────────

function formatAndCalc(el) {
  var raw = el.value.replace(/[^0-9.]/g, '');
  if (raw === '' || raw === '.') {
    el.value = raw;
  } else {
    var parts = raw.split('.');
    parts[0] = parseInt(parts[0] || '0').toLocaleString();
    el.value = parts.join('.');
  }

  recalculate();
}

// ── Slider DOM Logic ────────────────────────────────────────

var baseSpendingValues = {};
var FREQ_LABELS = { annual: '/yr', monthly: '/mo', weekly: '/wk', daily: '/day' };

function getGrossIncome() {
  return readField('salary') + readField('bonus') + readField('otherIncome');
}

function onSlider(el) {
  // Just trigger recalculate - it will update all displays
  recalculate();
}

function resetSliders() {
  var names = Object.keys(E.SLIDER_CONFIG);
  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    var slider = $('slider-' + name);
    if (slider) slider.value = 50; // Middle of 0-100 range
  }
  recalculate(); // Update all displays once
}

function updateAllSliderDisplays() {
  var names = Object.keys(E.SLIDER_CONFIG);
  var grossIncome = getGrossIncome();

  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    var slider = $('slider-' + name);
    if (!slider) continue;

    var sliderValue = parseFloat(slider.value);
    var result = E.computeSliderAmount(name, sliderValue, grossIncome);

    // Update percentage display
    setText('mult-' + name, (result.percentage * 100).toFixed(1) + '%');

    // Update amount display
    var amountEl = $('amount-' + name);
    if (amountEl) {
      var freqLabel = FREQ_LABELS[result.displayFreq] || '/yr';
      amountEl.textContent = E.fmtk(result.displayAmount) + freqLabel;
    }
  }
}

// ── Preset Application ──────────────────────────────────────

function computePresetSliderPositions(preset) {
  // Calculate what percentage of gross income each category represents
  var gross = preset.salary + preset.bonus + preset.otherIncome;
  if (gross === 0) return {};

  var categoryTotals = {};
  var names = Object.keys(E.SLIDER_CONFIG);

  // Sum up spending per slider category
  for (var i = 0; i < names.length; i++) {
    var name = names[i];
    var items = E.SLIDER_MAPPING[name] || [];
    var total = 0;
    for (var j = 0; j < items.length; j++) {
      var freq = items[j].freq;
      var key = items[j].key;
      var val = (preset.spending[freq] && preset.spending[freq][key]) || 0;
      total += val * (E.FREQ_TO_ANNUAL[freq] || 1);
    }
    categoryTotals[name] = total;
  }

  // Convert totals to slider positions
  var sliderPositions = {};
  for (var name in categoryTotals) {
    var pct = categoryTotals[name] / gross;
    sliderPositions[name] = E.percentageToSlider(name, pct);
  }

  return sliderPositions;
}

function applyPreset(name, btnEl) {
  var p = E.PRESETS[name];
  if (!p) return;

  document.querySelectorAll('.preset-btn').forEach(function(b) { b.classList.remove('active'); });
  if (btnEl) btnEl.classList.add('active');

  setField('salary', p.salary);
  setField('bonus', p.bonus);
  setField('otherIncome', p.otherIncome);
  setField('retirement', p.retirement);
  setField('insurance', p.insurance);
  setField('hsa', p.hsa);
  setField('otherDeductions', p.otherDeductions);

  // Compute slider positions from preset spending
  var sliderPositions = computePresetSliderPositions(p);
  var sliderNames = Object.keys(E.SLIDER_CONFIG);
  for (var i = 0; i < sliderNames.length; i++) {
    var sliderName = sliderNames[i];
    var slider = $('slider-' + sliderName);
    if (slider && sliderPositions[sliderName] !== undefined) {
      slider.value = sliderPositions[sliderName];
    }
  }

  recalculate();
}

// ── Init ────────────────────────────────────────────────────

document.addEventListener('DOMContentLoaded', function() {
  // Apply a default preset to initialize reasonable values
  applyPreset('mid', document.querySelector('.preset-btn:nth-child(2)'));
});
</script>
</body>
</html>
